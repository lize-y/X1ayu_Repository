# AOF日志

- 执行完写操作命令后，会将命令追加到server.aof_buf缓冲区
- 通过write()系统调用，将aof_buf缓冲区数据写入AOF文件（此时未写入磁盘）
- 具体什么时间写入磁盘，由内核决定
![[AOF写入.webp]]
## 写回策略
- Always
- Everysec
- No
## 重写机制
- AOF文件大小超过阈值时触发
- 读取最新键值对记录
- 由后台子进程bgrewriteaof来完成
- 重写过程中将新执行的命令写到**AOF缓冲区**和**AOF重写缓冲区**
- 子进程完成重写工作后，主进程将AOF重写缓冲区的所有内容追加到新的AOF文件中，覆盖现有AOF文件
# RDB快照
